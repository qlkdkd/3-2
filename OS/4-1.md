# 4. 스레드와 멀티스레딩
## 1. 프로세스의 문제점
### 프로세스의 문제점
#### 다중 프로세스를 이용한 멀티태스킹
* 응용 프로그램에서 여러 프로세스를 생성하여 동시에 여러 작업 실행
* 운영체제는 스케줄링을 통해 여러 프로세스(작업)를 번갈아 실행

#### 프로세스를 실행 단위로 하는 멀티태스킹의 문제점
1. 프로세스 생성의 큰 오버헤드
* 프로세스를 위한 메모리 할당, 부모프로세스로부터 복사
* PCB 생성, 매핑 테이블(페이지 테이블) 생성 등

2. 프로세스 컨텍스트 스위칭의 큰 오버헤드
* CPU 레지스터들을 컨텍스트로 PCB에 저장, 새 프로세스 컨텍스트를 PCB에서 CPU로 옮기는 시간
* CPU가 참고할 매핑 테이블(페이지 테이블)의 교체 시간
* CPU 캐시에 새 프로세스의 코드와 데이터가 채워지는데 걸리는 시간 등

3. 프로세스 사이 통신의 어려움
* 프로세스가 다른 프로세스의 메모리에 접근 불가
* 프로세스 사이의 통신을 위한 제 3의 방법 필요
* 커널 메모리나 커널에 의해 마련된 메모리 공간을 이용하여 데이터 송수신
  * 신호, 소켓, 메시지 큐, 세마포, 공유 메모리, 메모리 맵 파일 등
* 이 방법들은 코딩이 어렵고, 실행속도 느리고, 운영체제 호환성 부족

### 프로세스 사이의 통신 기법들
![image](https://github.com/user-attachments/assets/8ee2b9a0-2328-4cb7-b36c-29377c7ab091)

## 2. 스레드 개념
### 스레드 출현 목적
#### 프로세스를 실행 단위로 하는 멀티태스킹의 문제점
* 커널에 많은 시간, 공간 부담-> 시스템 전체 속도 저하

#### 효율적인 새로운 실행 단위 필요: 스레드 출현
1. 프로세스보다 크기 작음
2. 프로세스보다 생성 및 소멸이 빠름
3. 컨텍스트 스위칭 빠름
4. 통신이 쉬운 실행단위 필요

### 스레드 개념
#### 스레드는 실행 단위이며 스케줄링 단위
* 스레드는 응용 프로그램 개발자에게는 작업을 만드는 단위
  * 하나의 응용 프로그램에 동시에 실행할 여러 작업(스레드) 작성 가능
  * 작업은 독립적으로 실행되는 함수로 작성
* 스레드는 운영체제에게 실행 단위이고, 스케줄링 단위
* 스레드는 코드, 데이터, 힙, 스택을 가진 실체
* 스레드마다 스레드 정보를 저장하는 구조체 TCB(Thread Control Block) 있음

#### 프로세스는 스레드들의 컨테이너
* 프로세스 개념이 스레드들의 컨테이너 역할로 수정됨
* 프로세스는 반드시 1개 이상의 스레드로 구성
  * 프로세스가 생성될 때 운영체제에 의해 자동으로 1개의 스레드 생성: 메인 스레드(main thread)라고 부름
* 프로세스는 회사, 스레드는 직원에 비유
  * 직원은 회사의 목적을 위해 일을 하는 단위
  * 스레드는 프로세스(응용 프로그램)의 목적을 위해 동시에 실행될 작업(코드) 단위
  * 직원이 3명이면 동시에 일을 하는 사람이 3명인 것처럼, 프로세스에게 3개의 스레드가 있으면 3개의 작업이 동시에 실행
 
![image](https://github.com/user-attachments/assets/fcb2e7d7-5262-42fb-8eeb-6a1da6eed1e2)

![image](https://github.com/user-attachments/assets/298770e4-0872-45eb-a5ac-37159a3414ae)
> * 위 그림은 멀티스레드 운영체제에서 프로세스와 스레드를 관리하는 모양이다.
> * 프로세스마다 PCB가 생성되고, 스레드마다 스레드 정보를 담는 TCB 구조체가 생성된다.
> * TCB는 스레드 엔터티라고도 부르며, 스케줄링 단위가 스레드이므로 TCB나 스레드를 스케줄링 엔터티라고도 부른다.

#### 프로세스는 스레드들의 공유 공간(환경) 제공
* 모든 스레드는 프로세스의 코드, 데이터, 힙을 공유하며, 프로세스의 스택 공간을 나누어 사용
* 공유되는 공간을 이용하면 스레드 사이의 통신 용이
* -> 프로세스가 독립적인 메모리 공간을 가지고 있어 프로세스 사이에 데이터를 주고 받았는데 있었던 심각한 어려움 해소

![image](https://github.com/user-attachments/assets/4d6b4a61-5c46-46f4-bdfa-e8f67368edde)

![image](https://github.com/user-attachments/assets/7619639c-d082-4449-9c8a-a6f6edc0d18f)

#### 스레드가 실행할 작업은 함수로 작성
* 응용프로그램 개발자는 스레드가 실행할 작업을 함수로 작성
  * 함수를 실행할 스레드 생성을 운영체제에게 요청할 떄 스레드 생성
  * 운영체제는 TCB 생성, 함수의 주소를 스레드 실행 시작 주소로 TCB에 등록
  * 스레드 생성은 곧 TCB 생성
 
* 운영체제는 TCB 리스트로 전체 스레드 관리
  * 스레드 스케줄: TCB 중에서 하나 선택, 스레드 단위로 스케줄
  * TCB에 기록된 스레드의 시작 주소를 CPU에 적재하면 실행 시작됨
 
#### 스레드의 생명과 프로세스의 생명
* 스레드로 만든 함수가 종료하면 스레드 종료
* 스레드가 종료하면 TCB등 스레드 관련 정보 모두 제거
* 프로세스에 속한 모든 스레드가 종료될 때, 프로세스 종료
