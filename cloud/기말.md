# Amazon RDS
## 1. Amazon RDS란?
* Amazon Relational Database Service는 AWS에서 제공하는 관리형 데이터베이스
  * 관리의 복잡성 줄이고, 고가용성과 확장성을 갖춘 RDBS를 손쉽게 구축, 운영, 확장할 수 있도록 지원
 
### 1.1 주요 특징
#### 1. 관리형 서비스
* 설치, 유지관리, 백업, 소프트웨어 패치 등을 자동으로 처리
  * 사용자는 데이터베이스 서버의 설정이나 운영체제 관리에 신경쓰지 않고, 애플리케이션 개발과 데이터베이스 사용에만 집중할 수 있음
 
#### 2. 다양한 데이터베이스 엔진 지원
* 여러 인기있는 관계형 데이터베이스 지원
  * Amazon Aurora, MySQL, PostgreSQL등
* Amazon Aurora는 MySQL과 PostgreSQL과 호환되며, 고성능과 자동 확장 기능 제공

#### 3. 고가용성 및 자동 복구
* RDS는 Multi-AZ배포 기능 통해 고가용성 제공
    * 데이터베이스 인스턴스를 기본 영역과 대기 영역에 자동으로 복제하여 장애 발생 시 대기 인스턴스로 자동으로 장애 조치를 수행함
    * Amazon RDS가 다른 가용 영역에서 등기식 대기 복제본을 자동으로 프로비저닝하고 유지 관리하는 다중 AZ DB 인스턴스 배포
 
![image](https://github.com/user-attachments/assets/38468a48-021b-4a47-b405-a0562b4e3140)

* Multi-AZ배포는 데이터베이스의 자동 복구와 장애 조치 지원-> 서비스 중단 최소화
* 읽기 복제본 기능: 데이터베이스의 읽기 부하 분산 -> 읽기 집중형 APP성능 향상
  * AWS리전에 있는 3개의 개별 가용 영역에 라이터 DB인스턴스 2개와 리더 DB 인스턴스가 있는 다중 AZ DB 클러스터 배포
    * 3개의 DB인스턴스 모두 읽기 트래픽 처리 가능
 
![image](https://github.com/user-attachments/assets/706384e2-8f3d-495c-8a89-f140272ff041)

#### 4. 확장성
* 스토리지 자동 확장
  * Amazon Aurora, MySQL, MariaDB, PostgreSQL같은 엔진에서 사용 가능
  * DB용량 자동으로 늘릴 수 있음
* 컴퓨팅 리소스 확장
  * 서버리스 환경에서 컴퓨팅 리소스를 자동으로 조정할 수 있는 옵션 제공
  * 데이터베이스의 워크로드에 따라 자동으로 용량이 확장 및 축소
  * 서버리스 모드에서는 데이터베이스가 활성화되면 필요한 만큼의 컴퓨팅 리소스를 자동으로 할당
  * 트래픽이 적거나 없을 때는 자동으로 리소스를 축소하여 비용 절감
 
#### 5. 보안
* RDS는 IAM과 통합되어 사용자가 데이터베이스 인스턴스에 접근할 수 있는 권한 제어 가능
* VPC(가상 프라이빗 클라우드)와 통합
  * RDS인스턴스를 네트워크 내에서 안전하게 배포 가능
  * VPC보안 그룹을 사용해 데이터베이스에 대한 접근 제한 가능
 
* 예제: ec2-rds-x VPC보안 그룹을 사용하여 클라이언트 애플리케이션의 IP주소를 소스로 사용하는 인바운드 규칙 정의
  * 애플리케이션은 이 보안 그룹에 속함
  * rds-ec2-x라는 이름의 보조 보안 그룹은 ec2-rds-x를 소스로 지정하고 RDS DB인스턴스에 연결함
  * 보안 그룹 규칙에 따르면 클라이언트 애플리케이션은 DB인스턴스에 직접 액세스할 수 없지만, EC2인스턴스는 DBㅇㄴ스턴스에 액세스할 수 있음

![image](https://github.com/user-attachments/assets/c3f4e626-552e-4b17-b859-feff3be4f5c3)

* TLS(Transport Layer Security)를 통해 데이터 전송 중 암호화를 제공하며, AWS KMS(AWS Key Management Service)를 사용하여 데이터베이스 암호화 지원
* 데이터베이스 인스턴스, 자동 백업, 스냅샷을 수동으로 생성할 수 있으며, 스냅샷은 필요할 때 새로운 데이터베이스 인스턴스로 복원 가능

* ### 1.2. Amazon RDS 구성요소
* #### DB 인스턴스
* * Amazon RDS의 기본 구성요소로서, 클라우드에 있는 격리된 데이터베이스 환경
    * 사용자가 만든 여러 데이터베이스 포함
    * 기존 도구 및 애플리케이션(예: 표준 SQL 클라이언트)을 통해 DB 인스턴스에 접근 가능
    * AWS 명령행 인터페이스(CLI), Amazon RDS API, AWS Management Console을 사용해 DB인스턴스를 만들고 수정할 수 있음
* 하나의 DB인스턴스는 선택한 데이터베이스 엔진을 실행하며, 이 인스턴스 위에 여러 데이터베이스를 생성할 수 있음
* DB인스턴스 클래스: DB인스턴스의 CPU및 메모리 용량 결정
* DB인스턴스의 스토리지
  * 5GB에서 6TB까지 용량 선택 가능
  * 마그네틱, 범용 및 프로비저닝 된 등 세 가지 유형
* 아마존의 VPC서비스를 사용해 가상 사설 클라우드에서 DB인스턴스를 실행 가능

#### 보안 그룹
* DB인스턴스에 대한 액세스를 제어
  * 사용자가 지정한 IP주소 범위 또는 Amazon EC2인스턴스에서 액세스할 수 있도록 허용하는 방법으로 제어
* Amazon RDS는 DB보안 그룹, VPC보안그룹 및 EC2보안그룹을 사용
  * DB보안그룹은 VPC외부의 DB 인스턴스에 대한 엑세스 제어
  * VPC보안그룹은 VPC내부의 DB 인스턴스에 대한 액세스 제어
  * EC2보안그룹은 EC2 인스턴스에 대한 엑세스 제어, DB인스턴스와 함께 사용
 
![image](https://github.com/user-attachments/assets/cac98ade-04fc-4862-9acf-4d3cf94e173b)

#### DB 파라미터 그룹
* DB 파라미터 그룹을 사용해 DB엔진의 구성을 관리
* 인스턴스 유형이 같은 하나 이상의 DB인스턴스에 적용할 수 있는 엔진 구성 값을 포함
* DB인스턴스를 만들 때 DB파라미터 그룹을 지정하지 않으면 Amazon RDS가 기본 DB파라미터 그룹을 적용
  * 기본 그룹에는 특정 데이터베이스 엔진 및 DB인스턴스의 인스턴스 클래스에 대한 기본값이 포함

#### DB옵션 그룹
* 일부 DB엔진은 데이터베이스를 간편하게 관리하고 데이터를 적극 활용할 수 있는 추가 기능 제공
* Amazon RDS는 DB옵션 그룹을 사용하여 이러한 기능을 활성화하고 구성

---

# 디바이스 섀도우
## 개요
* 사물: 물리적 디바이스를 클라우드에서 표현하고 기록한 것. 물리적 디바이스와 AWS IOT의 호환을 위해서는 사물 레코드 필요
* AWS IoT디바이스 섀도우 서비스는 AWS IoT 사물 객체에 섀도우 추가
* 섀도우: 디바이스, 앱 및 기타 클라우드 서비스가 데이터를 공유할 수 있는 신뢰할 수 있는 데이터 스토어 제공
  * AWS IoT에 연결되어 있는 동안 디바이스, 앱 및 기타 클라우드 서비스가 해당 섀도우를 통해 디바이스의 현재 상태에 액세스하고 제어할 수 있음
 
![image](https://github.com/user-attachments/assets/9465feef-b0f7-4215-9f52-a2cc7b4f6e5d)

* 섀도우를 사용하면 디바이스가 AWS IoT에 연결되어 있는지 여부에 관계없이 앱 및 기타 서비스에서 디바이스의 상태를 사용할 수 있음
  * 디바이스 다시 연결: 섀도우의 현새 상태 수신-> 섀도우와 일치하도록 상태를 업데이트-> 업데이트된 상태로 메시지 게시
  * 앱이 오프라인 전환되고 디바이스 상태가 변경된 경우: 디바이스 섀도우는 섀도우를 업데이터하여 앱이 다시 연결될 때 섀도우에 현재 상태를 쿼리하도록 할 수 있음

## 디바이스 섀도우 서비스를 이용한 디바이스 상태 수집 및 제어
### 디바이스 섀도우 서비스
* 디바이스 섀도우 서비스는 중간 역할을 수행하여 디바이스와 애플리케이션이 디바이스의 현재 상태 정보를 검색하고 업데이트할 수 있게 함
* AWS IoT는 디바이스 섀도우 작업을 위한 세 가지 메서드 제공
  * Update
    * 디아비스 섀도우가 존재하지 않을 경우 디바이스 섀도우 생성
    * 요청에 의해 요구된 데이터로 디바이스 섀도우의 내용 변경
    * 데이터는 마지막으로 변경된 시간을 나타내는 타임 스탬프 정보와 함께 저장됨
  * GET
    * 디바이스 섀도우에 저장된 최신 상태 검색
    * 메타데이터를 포함하여 전체 JSON문서 반환
  * DELETE
    * 디바이스 섀도우를 모든 내용을 포함하여 삭제
### 디바이스 섀도우 서비스 사용 시나리오
* 디바이스 상태가 변경되는 경우
* 애플리케이션이 디바이스의 상태 변경을 요청하는 경우
* 애플리케이션이 디바이스의 상태 변경을 요청하는 경우

![image](https://github.com/user-attachments/assets/72a7cb27-b843-4ba7-ba82-c4e094f191a3)

![image](https://github.com/user-attachments/assets/04095340-5d24-41f7-887b-12b2c0a43896)

![image](https://github.com/user-attachments/assets/161d3b60-05d3-420e-ae28-6c7d85f57a04)

---

# AWS Lambda 시작하기
### AWS SAM(AWS Serverless Application Model)
* AWS SAM이란 AWS 클라우드에서 서버리스 애플리케이션을 정의하고 배포하기 위한 오픈소스 프레임워크임
* AWS SAM CLI는 이 프레임워크를 CLI(Command Line Interface)로 실행하고 관리할 수 있는 도구
* 주요 기능
  * 로컬 테스트 및 디버깅: 서버리스 애플리케이션을 로컬 환경에서 AWS Lambda와 API Gateway를 에물레이트하여 테스트할 수 있음.
    * 디버깅 도구를 통해 람다함수의 로직을 디버깅 가능
  * 애플리케이션 빌드: SAM CLI는 소스 코드를 빌드하고 배포 가능한 상태로 패키징
  * AWS에 배포: CloudFormation 템플릿 생성하고, 이를 기반으로 애플리케이션을 AWS에 배포
  * 템플릿 유효성 검사: AWS SAM템플릿의 문법 및 구성을 검증
  * 로컬 컨테이너 기반 실행: 람다의 런타임 환경을 도커 컨테이너를 통해 로컬에서 에뮬레이션함
  * 자동화 및 CI/CD 통합
 
### Docker
* Docker는 애플리케이션과 해당 환경을 컨테이너로 패키징하여 개발, 배포, 실행할 수 있게 해주는 오픈소스 플랫폼
  * 컨테이너라는 가벼운 가상화 기술을 활용해 애플리케이션을 격리된 환경에서 실행할 수 있도록 지원
* Docker의 주요 특징
  * 컨테이너 기반 기술
    * 컨테이너는 애플리케이션과 필요한 모든 종속성을 함께 패키징한 경량의 실행 단위
    * 컨테이너는 애플리케이션 실행 환경을 격리하여, 개발 환경과 배포 환경 간의 차이를 최소화
  * 운영체제 수준 가상화: 도커는 운영체제의 커널을 공유하는 가상화 기술을 사용하여, 기존의 VM보다 가볍고 빠름
  * 이식성: 컨테이너는 개발 환경, 테스트 환경, 운영 환경에서 동일하게 실행됨: 한번 빌드한 컨테이너 이미지는 어디서나 실행 가능
  * 빠른 시작: 컨테이너는 경량화되어 있어 애플리케이션 시작 시간이 매우 빠름
  * 이미지 기반 배포: 도커 이미지는 애플리케이션과 종속성을 포함한 읽기 전용 패키지임. 이미지는 계층(layer)구조로 되어 있어 효율적으로 관리됨
 
---

# DynamoDB
## Amazon Dynamo DB란?
* 어떤 규모에서도 10ms미만의 성능을 제공하는 키-값 문서 데이터베이스
  * 유연한 스키마: 어느 시점에서는 각 행은 개수와 상관 없이 열을 포함할 수 있음
  * RDBMS처럼 테이블 스키마를 재정의할 필요 없이 비즈니스 요구사항이 변경되면 테이블을 쉽게 조정 가능
### 핵심 구성 요소
* 테이블: 데이터를 테이블에 저장. 테이블은 데이터의 집합
* 항목: 각 테이블에는 0개 이상의 항목 존재. 항목은 모든 기타 항목 중에서 고유하게 식별할 수 있는 속성들의 집합.
* 속성: 각 항목은 하나 이상의 속성으로 구성. 속성은 기본적인 데이터 요소로서 더 이상 나뉠 필요가 없음

* 예제: people 테이블

![image](https://github.com/user-attachments/assets/17ad036e-ef47-4c7e-a529-210134586f02)

  * 테이블의 각 항목에는 항목을 테이블의 다른 모든 항목과 구별해 주는 고유 식별자인 기본 키 존재.
    * People테이블에서 기본 키는 한 개의 속성(PersonID)로 구성
  * 기본 키를 제외하고, People테이블에는 스키마가 없음.
    * 이는 속성이나 데이터 형식을 미리 정의할 필요가 없음을 의미. 각 항목에는 자체의 고유 속성 있을 수 있음
  * 대부분의 속성은 스칼라인데, 이는 하나의 값만 가질 수 있다는 의미. 문자열 및 숫자가 스칼라의 일반적인 예
  * 일부 항목은 내포 속성을 갖음. DynamoDB는 32수준 깊이까지 내포 속성 지원

* 예제: Music 테이블

![image](https://github.com/user-attachments/assets/6c7849c6-e9f1-4bf7-8ab4-ee47ca969e32)

  * Music의 기본 키는 두 개의 속성(Artist 및 Song)으로 구성되어 있음
  * 기본 키를 제외하고, Music테이블에는 스키마기 없음. 이는 속성이나 데이터 형식을 미리 정의할 필요가 없음을 의미함. 각 항목에는 자체의 고유 속성이 있을 수 있음
  * 항목 중 하나에는 내포 속성(PromotionInfo)이 있는데, 이 속성은 다른 내포 속성을 포함함. DynamoDB는 32수준 깊이까지 내포 속성 지원
 
### 기본 키
* 테이블을 생성할 때 테이블 이름 외에도 테이블의 기본 키를 지정해야 함
  * 기본 키: 테이블의 각 항목을 나타내는 고유 식별자
* DynamoDB는 두 가지 기본 키 지원
  * 파티션 키: *파티션 키*로 알려진 **하나의 속성으로 구분되는 단순 기본 키**
    * DynamoDB는 내부 해시 함수에 대한 입력으로 파티션 키 값을 사용함. 해시 함수 출력에 따라 항목을 저장할 파티션(DynamoDB내부의 물리적 스토리지)이 결정됨
    * 파티션 키로만 구성되어있는 테이블에서는 어떤 두 개의 테이블 항목도 동일한 파티션 키 값을 가질 수 없음
    * 다음 다이어그램은 여러 파티셔네 걸쳐 데이터가 저장된 Pets라는 테이블을 보여줌. 테이블의 기본 키는 AminalType(이 키 속성만 표시됨)임.
      * DynamoDB는 해시 함수를 사용하여 새 항목을 저장할 위치를 결정함.
      * 이 경우 문자열 Dog의 해시 값이 기준으로 사용됨.
      * 항목은 정렬 순서대로 저장되지 않음. 각 항목의 위치는 파티션 키의 해시 값으로 결정됨
     
![image](https://github.com/user-attachments/assets/08218167-0af7-4ecf-8ee3-88d50b113f50)

* 파티션 키 및 정렬 키: 복합 기본 키로 지칭되는 이 형식의 키는 두 개의 속성으로 구성: 파티션 키, 정렬 키
  * 내부 해시 함수에 대한 입력으로 파티션 키 값 사용
  * 파티션 키와 정렬 키로 구성되어 있는 테이블에서는 두 개의 항목이 동일한 파티션 키 값을 가질 수 있음. 그러나 두 아이템의 정렬키 값은 달라야 함
  * 복합 기본 키를 사용하면 보다 유연하게 데이터를 쿼리할 수 있음
    * 예를 들어, Artist값만 제공하는 경우, DynamoDB가 파티션 키 값 Dog와 정렬키 값 Fido를 사용하여 항목을 기록함
   
![image](https://github.com/user-attachments/assets/857bd36b-2741-4439-bfe3-2c3b57644bde)

---

# API Gateway
## API Gateway란?
* API Gateway: 개발자가 손쉽게 API를 생성, 게시, 유지관리, 모니터링할 수 있게 해주는 완전 관리형 서비스
  * API Gateway는 트래픽 관리, 권한 부여 및 액세스 제어, 모니터링 및 API버전 관리 등 최대 수십만 개의 동시 API호출을 수신 및 처리하는 데 관계된 모든 작업을 처리함
* API Gateway를 이용하여 할 수 있는 일
  * API 개발자: AWS또는 다른 웹 서비스 뿐만 아니라 AWS클라우드에 저장된 데이터에 액세스하는 API를 생성할 수 있음
  * API개발자는 자체 클라이언트 애플리케이션(앱)에서 사용할 API를 만들 수 있음. 또는 타사 앱 개발자가 API를 사용하도록 제공할 수 있음
  * 앱 개발자는 API Gateway에서 API개발자가 생성한 API를 호출하여 AWS 서비스를 호출하기에 효과적인 애플리케이션을 구축함
 
![image](https://github.com/user-attachments/assets/36a4b0ba-2abb-4d9d-91de-1e57296bea5a)

#### API Gateway를 통해 만들 수 있는 API종류
![image](https://github.com/user-attachments/assets/81c9d546-8378-4d37-b0af-fd7bbba0119d)

* REST API
  * 상태가 없는 클라이언트-서버 통신을 지원하는 REST 프로토콜 준수
  * 짧은 기간의 통신
  * HTTP 메소드(Get, Post, Put, Delete 등)
* WebSocket API
  * 클라이언트와 서버 간에 상태를 저장하는 전이중 통신을 지원하는 WebSocket 프로토콜 준수
  * 긴 기간의 통신
  * 양방향 통신 채널
 
### Amazon API Gateway에서 Lambda통합으로 RestAPI생성
![image](https://github.com/user-attachments/assets/6b3036d7-4109-49c6-89cd-8b36390050d8)

* RestAPI는 HTTP Request형식으로 표현됨
* API Gateway REST API에서 클라이언트는 메서드 요청 및 메서드 응답으로 캡슐됨
* API는 integration requests(통합 요청)및 integration responses(통합 응답)을 이용해 백엔드와 통신함
  * 예: Lambda가 백엔드일 때, API개발자는 수신되는 메서드 요청을 선택한 백엔드로 전달하도록 통합 요청 설정
  * 이 설정에는 적절한 Lambda작업에 필요한 IAM역할 및 정책, 필요한 입력 데이터 변환이 포함됨. 백엔드는 API Gateway에 통합 응답으로서 결과 반환
* Lambda 통합 사용하여 Rest API를 구축하는 방법은 Lambda 프록시 통합 또는 Lambda 비 프록시(사용자 지정) 통합이 있음
  * Lambda 프록시 통합에서는 통합 lamdba함수에 대한 입력을 HTTP Request형식(요청 헤더, 경로 변수, 쿼리 문자열 파라미터 및 본문의 조합)으로 표현
    * API개발자의 경우 지정된 리전에서 특정 Lambda함수를 선택하는 것만으로, Lamdba프록시 통합을 간단하게 설정할 수 있음
    * 설정을 완료하면 통합 API 메서드는 기존 설정을 수정하지 않고 백엔드와 함께 진화할 수 있음
    * 백엔드 Lambda함수 개발자가 수신되는 요청 데이터를 구문 분석하고 아무런 문제가 없을 때 원하는 결과와 함께 클라이언트에 응답하거나 무언가 문제가 있을 때 오류 메시지와 함꼐 응답하기 때문
   
![image](https://github.com/user-attachments/assets/4e021b4c-8129-45a2-baa4-05ff4c88cbc9)

  * lambda 비프록시 통합에서는 클라이언트가 제공하는 HTTP request를 lamdba함수가 인식하는 형식으로 변환함

![image](https://github.com/user-attachments/assets/4b824b18-b010-40d2-ade7-545b9e37960d)
